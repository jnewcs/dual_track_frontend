(this.webpackJsonpdual_track_frontend=this.webpackJsonpdual_track_frontend||[]).push([[5],{92:function(e,t,s){"use strict";s.r(t);var n=s(1),c=s(9),a=s(34),i=s(4),r=s(23),l=s(88),o=s(35),u=s(2),d=s(16),b=s(17),m=s(18),j=s(19),h=s(89),O=s.n(h),f=s(5),x=s.n(f),v=s(10),g=s(14),p=s(0),k=function(){var e=Object(n.useState)(null),t=Object(g.a)(e,2),s=t[0],c=t[1],a=Object(n.useState)(!1),i=Object(g.a)(a,2),r=i[0],l=i[1];if(!("wakeLock"in navigator))return null;var o=function(){var e=Object(v.a)(x.a.mark((function e(){var t;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.wakeLock.request("screen");case 3:t=e.sent,c(t),l(!0),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("".concat(e.t0.name,", ").concat(e.t0.message));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),u=function(){s&&s.release(),c(null),l(!1)};return Object(p.jsx)(p.Fragment,{children:r?Object(p.jsx)("div",{className:"button",tabIndex:"0",onClick:u,onKeyUp:function(e){return"Enter"===e.key&&u()},children:"Unlock Page"}):Object(p.jsx)("div",{className:"button",tabIndex:"0",onClick:o,onKeyUp:function(e){return"Enter"===e.key&&o()},children:"Lock Page"})})},y=function(){var e=Object(n.useState)(!!document.fullscreenElement),t=Object(g.a)(e,2),s=t[0],c=t[1],a=function(){document.documentElement.requestFullscreen(),c(!0)},i=function(){document.exitFullscreen(),c(!1)};return Object(p.jsx)(p.Fragment,{children:s?Object(p.jsx)("div",{className:"button",tabIndex:"0",onClick:i,onKeyUp:function(e){return"Enter"===e.key&&i()},children:"Leave Full Screen"}):Object(p.jsx)("div",{className:"button",tabIndex:"0",onClick:a,onKeyUp:function(e){return"Enter"===e.key&&a()},children:"Enter Full Screen"})})},N=function(e){var t=e.members,s=Object(i.f)().email;return!t||t.count<2?null:Object(p.jsxs)("h5",{className:"chat-title is-size-5",children:["People in Chat",Object(p.jsx)("br",{}),Object.values(t).map((function(e){var t=e.email===s?"is-link":"is-light";return Object(p.jsx)("div",{className:"tag ".concat(t),children:e.email},e.email)}))]})},S=function(e){var t=e.open,s=e.members,n=e.chatHistory,c=e.closeChat,a=e.message,r=e.setMessage,l=e.sendMessage,o=Object(i.f)().email;return!t||!s||Object.values(s).length<2?null:Object(p.jsxs)("div",{className:"chat-interface box has-background-link-light p-5",children:[Object(p.jsx)("div",{tabIndex:0,className:"delete is-clickable is-size-3 close-chat-interface",onClick:c,onKeyUp:function(e){return"Enter"===e.key&&c()},dangerouslySetInnerHTML:{__html:"&#215;"}}),Object(p.jsx)(N,{members:s}),Object(p.jsxs)("div",{className:"chat-messages box mt-2 p-3",children:[Object(p.jsx)("div",{className:"is-full-width is-flex is-justify-content-center mb-4",children:Object(p.jsx)("div",{className:"tag is-dark",children:"This is the beginning of your conversation history"})}),n.map((function(e,t){return e.sender===o?Object(p.jsx)("div",{className:"is-full-width is-flex is-justify-content-flex-end mb-2",children:Object(p.jsx)("div",{className:"tag is-medium is-link from-me-message is-pulled-right",children:e.message})},"chat-me-".concat(t)):Object(p.jsx)("div",{className:"mb-2",children:Object(p.jsx)("div",{className:"tag is-medium is-light to-me-message",children:e.message})},"chat-others-".concat(t))})),Object(p.jsx)("div",{id:"last-chat-element"})]}),Object(p.jsx)("div",{className:"chat-send-box box mt-2 p-3 mb-2",children:Object(p.jsxs)("div",{className:"is-flex",children:[Object(p.jsx)("input",{className:"input is-normal",type:"text",placeholder:"Enter your message",value:a,onChange:function(e){return r(e.target.value)},onKeyUp:function(e){return"Enter"===e.key&&l()}}),Object(p.jsx)("div",{className:"button is-primary ml-2",tabIndex:0,onClick:l,disabled:!a||!a.length,children:"Send"})]})})]})},C=function(e){var t=e.showChat,s=e.channel,c=e.chatHistory,a=e.setChatHistory,r=e.unreadMessage,o=e.setUnreadStatus,u=e.members,d=Object(n.useState)(!1),b=Object(g.a)(d,2),m=b[0],j=b[1],h=Object(n.useState)(""),O=Object(g.a)(h,2),f=O[0],x=O[1],v=Object(i.f)().email;if(Object(n.useEffect)((function(){var e=document.getElementById("last-chat-element");e&&e.scrollIntoView()}),[c,m]),Object(n.useEffect)((function(){var e=function(e){27===e.keyCode&&k(!1)};m?document.addEventListener("keydown",e,!1):document.removeEventListener("keydown",e,!1)}),[m]),!s||!t)return null;var k=function(){m?document.body.classList.remove("not-vertically-scrollable"):(o(!1),document.body.classList.add("not-vertically-scrollable")),j(!m)};return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)("button",{className:"button",tabIndex:0,onClick:k,disabled:Object.values(u).length<2,onKeyUp:function(e){return"Enter"===e.key&&k()},children:["Workout Chat",r&&Object(p.jsx)("div",{className:"dot ml-1 has-background-primary"})]}),Object(p.jsx)(S,{open:m,members:u,chatHistory:c,closeChat:function(){k(!1)},message:f,setMessage:x,sendMessage:function(){if(f&&f.length){var e={id:c.length+1,sender:v,message:f,timestamp:Date.now()};s.trigger("client-chat-message",e),a([].concat(Object(l.a)(c),[e])),x("")}}})]})};function w(e){var t=e/36e5,s=60*(t-Math.floor(t)),n=Math.floor(s),c=60*(s-n),a=Math.floor(c),i=100*(c-a),r=Math.floor(i),l=n.toString().padStart(2,"0"),o=a.toString().padStart(2,"0"),u=r.toString().padStart(2,"0");return"".concat(l,":").concat(o,":").concat(u)}var E=function(e){var t=e.showFinish,s=void 0===t||t,c=e.onPlayCallback,a=void 0===c?function(){}:c,i=e.onStopCallback,r=void 0===i?function(){}:i,l=e.onFinishCallback,o=void 0===l?function(){}:l,u=Object(n.useState)(!1),d=Object(g.a)(u,2),b=d[0],m=d[1],j=Object(n.useState)(null),h=Object(g.a)(j,2),O=h[0],f=h[1],x=Object(n.useState)(0),v=Object(g.a)(x,2),k=v[0],y=v[1],N=Object(n.useState)(null),S=Object(g.a)(N,2),C=S[0],E=S[1],I=function(){b?(clearInterval(C),r()):(f(Date.now()-k),a()),m(!b)};Object(n.useEffect)((function(){I()}),[]),Object(n.useEffect)((function(){if(null===O)clearInterval(C),E(null),y(0);else{var e=setInterval((function(){y(null===O?0:Date.now()-O)}),10);E(e)}}),[O]);var U=function(){b&&(I(),o(k))};return Object(p.jsxs)("div",{className:"has-text-centered is-flex is-flex-direction-column is-align-items-center",children:[Object(p.jsx)("div",{className:"stopwatch-circle circle is-flex is-justify-content-center is-align-items-center",children:Object(p.jsx)("span",{className:"time is-size-4",id:"display",children:k?w(k):"00:00:00"})}),Object(p.jsxs)("div",{className:"mt-3 is-flex is-justify-content-space-between is-align-items-center",children:[Object(p.jsx)("img",{className:"is-clickable",tabIndex:0,id:"main-action-button",alt:b?"pause stopwatch":"start stopwatch",src:b?"https://res.cloudinary.com/https-tinloof-com/image/upload/v1593360448/blog/time-in-js/pause-button_pinhpy.svg":"https://res.cloudinary.com/https-tinloof-com/image/upload/v1593360448/blog/time-in-js/play-button_opkxmt.svg",onClick:I,onKeyUp:function(e){return"Enter"===e.key&&I()}}),s&&b&&Object(p.jsx)("div",{className:"button ml-5 is-medium",tabIndex:0,id:"reset-button",onClick:U,onKeyUp:function(e){return"Enter"===e.key&&U()},children:"Finish"})]})]})},I=function(e){var t=e.segment,s=e.segmentLength,c=e.index,a=Object(n.useState)(!1),i=Object(g.a)(a,2),r=i[0],l=i[1],o=Object(n.useState)(null),u=Object(g.a)(o,2),d=u[0],b=u[1];return Object(p.jsx)("div",{className:"column is-one-third",children:Object(p.jsxs)("div",{className:"card",children:[Object(p.jsxs)("div",{className:"segment-position",children:[Object(p.jsx)("span",{className:"has-text-primary",children:c+1})," / ",s]}),Object(p.jsx)("div",{className:"card-content pt-1",children:Object(p.jsxs)("div",{className:"content",children:[Object(p.jsxs)("div",{className:"columns mt-1 is-flex",children:[Object(p.jsxs)("div",{className:"column is-half",children:[Object(p.jsxs)("b",{className:"is-size-5",children:[t.display_length," Goal"]}),Object(p.jsx)("br",{}),t.time_goal," seconds"]}),Object(p.jsxs)("div",{className:"column is-half",children:[Object(p.jsx)("b",{className:"is-size-5",children:"Rest"}),Object(p.jsx)("br",{}),t.rest," seconds"]})]}),d?Object(p.jsxs)("div",{className:function(){var e=d/1e3,s=t.time_goal-e;return s<-8?"notification is-danger":s<-4?"notification is-warning":"notification is-success"}(),children:[Object(p.jsx)("b",{className:"is-size-5",children:"Actual Time"}),Object(p.jsx)("br",{}),w(d)]}):Object(p.jsxs)(p.Fragment,{children:[!r&&Object(p.jsx)("div",{tabIndex:0,className:"button is-primary is-medium",onClick:function(){l(!r)},children:"Start"}),r&&Object(p.jsx)(E,{onFinishCallback:function(e){l(!1),b(e)}})]}),Object(p.jsx)("hr",{}),Object(p.jsx)("p",{children:t.description})]})})]})})},U=function(e){var t=e.selectedWorkout;if(!t||!t.segments||!t.segments.length)return Object(p.jsx)("p",{className:"mb-3",children:"Workout cannot start. No segments added yet :("});var s=t.segments,n=s.length;return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)("div",{className:"is-size-3 mb-5",children:[n," Total ",1===n?"Segment":"Segments"]}),Object(p.jsx)("div",{className:"segments columns",children:s.map((function(e,t){return Object(p.jsx)(I,{segment:e,segmentLength:n,index:t},e.identifier)}))})]})},F=function(e){Object(m.a)(s,e);var t=Object(j.a)(s);function s(e){var n;Object(d.a)(this,s),(n=t.call(this,e)).setChatHistory=function(e){n.setState({chatHistory:e})},n.setUnreadStatus=function(e){n.setState({unreadMessage:e})},n.state={chatHistory:[],unreadMessage:!1,members:[],showChat:!1};return O.a.logToConsole=!1,n.pusher=new O.a("cebc878343c66e63a78e",{cluster:"us3",authEndpoint:"".concat("https://glacial-plateau-65219.herokuapp.com","/pusher/auth"),auth:{headers:{Authorization:localStorage.getItem("currentUserToken")||""}}}),n.channel=n.pusher.subscribe("presence-workoutChannel-".concat(n.identifier)),n}return Object(b.a)(s,[{key:"identifier",get:function(){return this.props.selectedWorkout.identifier}},{key:"componentDidMount",value:function(){var e=this;this.channel.bind("pusher:subscription_succeeded",(function(e){this.setState({members:e.members,showChat:!0})}),this),this.channel.bind("pusher:member_added",(function(e){var t=Object(u.a)(Object(u.a)({},this.state.members),{},Object(o.a)({},e.id,e.info));this.setState({members:t})}),this),this.channel.bind("pusher:member_removed",(function(e){var t=this,s=Object.keys(this.state.members).filter((function(t){return"".concat(t)!=="".concat(e.id)})).reduce((function(e,s){return e[s]=t.state.members[s],e}),{});this.setState({members:s})}),this),this.channel.bind("client-chat-message",(function(t){e.setState({chatHistory:[].concat(Object(l.a)(e.state.chatHistory),[Object(u.a)({},t)]),unreadMessage:!0})}),this)}},{key:"componentWillUnmount",value:function(){this.pusher.unsubscribe("presence-workoutChannel-".concat(this.identifier)),this.channel&&this.channel.unbind(),document.body.classList.remove("not-vertically-scrollable")}},{key:"render",value:function(){return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)("div",{className:"buttons",children:[Object(p.jsx)(k,{}),Object(p.jsx)(y,{}),Object(p.jsx)(C,Object(u.a)({channel:this.channel,setChatHistory:this.setChatHistory,setUnreadStatus:this.setUnreadStatus},this.state))]}),Object(p.jsx)(U,{selectedWorkout:this.props.selectedWorkout})]})}}]),s}(n.Component);t.default=function(e){var t=e.match.params.identifier,s=Object(i.f)(),l=s.selectedWorkout,o=s.error,u=s.loading,d=Object(i.e)();return Object(n.useEffect)((function(){Object(r.b)(t,d)}),[t,d]),u?Object(p.jsx)(a.a,{}):l&&Object.keys(l).length?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("nav",{className:"breadcrumb","aria-label":"breadcrumbs",children:Object(p.jsxs)("ul",{children:[Object(p.jsx)("li",{children:Object(p.jsx)(c.b,{to:"/workouts",className:"",children:"Workouts"})}),Object(p.jsx)("li",{className:"is-active",children:Object(p.jsx)("div",{className:"ml-3",children:l.name})})]})}),Object(p.jsx)(F,{selectedWorkout:l})]}):Object(p.jsxs)("div",{className:"has-text-centered",children:[Object(p.jsx)("h1",{className:"is-size-3",children:o}),Object(p.jsx)(c.b,{to:"/workouts",className:"button mt-3",children:"Return to My Workouts"})]})}}}]);
//# sourceMappingURL=5.1b507bce.chunk.js.map