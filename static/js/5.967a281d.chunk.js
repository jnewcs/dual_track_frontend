(this.webpackJsonpdual_track_frontend=this.webpackJsonpdual_track_frontend||[]).push([[5],{91:function(e,t,n){"use strict";n.r(t);var s=n(1),c=n(9),a=n(34),i=n(4),r=n(23),o=n(87),l=n(35),u=n(2),b=n(16),d=n(17),h=n(18),m=n(19),j=n(88),f=n.n(j),O=n(5),v=n.n(O),p=n(10),x=n(14),g=n(0),y=function(){var e=Object(s.useState)(null),t=Object(x.a)(e,2),n=t[0],c=t[1],a=Object(s.useState)(!1),i=Object(x.a)(a,2),r=i[0],o=i[1];if(!("wakeLock"in navigator))return null;var l=function(){var e=Object(p.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.wakeLock.request("screen");case 3:t=e.sent,c(t),o(!0),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("".concat(e.t0.name,", ").concat(e.t0.message));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),u=function(){n&&n.release(),c(null),o(!1)};return Object(g.jsx)(g.Fragment,{children:r?Object(g.jsx)("div",{className:"button",tabIndex:"0",onClick:u,onKeyUp:function(e){return"Enter"===e.key&&u()},children:"Unlock Page"}):Object(g.jsx)("div",{className:"button",tabIndex:"0",onClick:l,onKeyUp:function(e){return"Enter"===e.key&&l()},children:"Lock Page"})})},k=function(){var e=Object(s.useState)(!!document.fullscreenElement),t=Object(x.a)(e,2),n=t[0],c=t[1],a=function(){document.documentElement.requestFullscreen(),c(!0)},i=function(){document.exitFullscreen(),c(!1)};return Object(g.jsx)(g.Fragment,{children:n?Object(g.jsx)("div",{className:"button",tabIndex:"0",onClick:i,onKeyUp:function(e){return"Enter"===e.key&&i()},children:"Leave Full Screen"}):Object(g.jsx)("div",{className:"button",tabIndex:"0",onClick:a,onKeyUp:function(e){return"Enter"===e.key&&a()},children:"Enter Full Screen"})})};function N(e){var t=e/36e5,n=60*(t-Math.floor(t)),s=Math.floor(n),c=60*(n-s),a=Math.floor(c),i=100*(c-a),r=Math.floor(i),o=s.toString().padStart(2,"0"),l=a.toString().padStart(2,"0"),u=r.toString().padStart(2,"0");return"".concat(o,":").concat(l,":").concat(u)}var S=function(e){var t=e.showReset,n=void 0===t||t,c=e.onPlayCallback,a=void 0===c?function(){}:c,i=e.onStopCallback,r=void 0===i?function(){}:i,o=Object(s.useState)(!1),l=Object(x.a)(o,2),u=l[0],b=l[1],d=Object(s.useState)(null),h=Object(x.a)(d,2),m=h[0],j=h[1],f=Object(s.useState)(0),O=Object(x.a)(f,2),v=O[0],p=O[1],y=Object(s.useState)(null),k=Object(x.a)(y,2),S=k[0],w=k[1],C=function(){u?(clearInterval(S),r()):(j(Date.now()-v),a()),b(!u)};Object(s.useEffect)((function(){if(null===m)clearInterval(S),w(null),p(0);else{var e=setInterval((function(){p(null===m?0:Date.now()-m)}),10);w(e)}}),[m]);var E=function(){j(null),b(!1)};return Object(g.jsxs)("div",{className:"box has-text-centered is-flex is-flex-direction-column is-align-items-center",children:[Object(g.jsx)("h2",{className:"is-size-2 mb-3",children:"Stopwatch"}),Object(g.jsx)("div",{className:"stopwatch-circle circle is-flex is-justify-content-center is-align-items-center",children:Object(g.jsx)("span",{className:"time is-size-2",id:"display",children:v?N(v):"00:00:00"})}),Object(g.jsxs)("div",{className:"mt-3 is-flex is-justify-content-space-between",children:[Object(g.jsx)("img",{className:"is-clickable mr-5",tabIndex:0,id:"main-action-button",alt:u?"pause stopwatch":"start stopwatch",src:u?"https://res.cloudinary.com/https-tinloof-com/image/upload/v1593360448/blog/time-in-js/pause-button_pinhpy.svg":"https://res.cloudinary.com/https-tinloof-com/image/upload/v1593360448/blog/time-in-js/play-button_opkxmt.svg",onClick:C,onKeyUp:function(e){return"Enter"===e.key&&C()}}),n&&Object(g.jsx)("img",{className:"is-clickable",tabIndex:0,id:"reset-button",alt:"reset stopwatch",src:"https://res.cloudinary.com/https-tinloof-com/image/upload/v1593360448/blog/time-in-js/reset-button_mdv6wf.svg",onClick:E,onKeyUp:function(e){return"Enter"===e.key&&E()}})]})]})},w=function(e){var t=e.members,n=Object(i.f)().email;return!t||t.count<2?null:Object(g.jsxs)("h5",{className:"chat-title is-size-5",children:["People in Chat",Object(g.jsx)("br",{}),Object.values(t).map((function(e){var t=e.email===n?"is-link":"is-light";return Object(g.jsx)("div",{className:"tag ".concat(t),children:e.email},e.email)}))]})},C=function(e){var t=e.open,n=e.members,s=e.chatHistory,c=e.closeChat,a=e.message,r=e.setMessage,o=e.sendMessage,l=Object(i.f)().email;return!t||!n||Object.values(n).length<2?null:Object(g.jsxs)("div",{className:"chat-interface box has-background-link-light p-5",children:[Object(g.jsx)("div",{tabIndex:0,className:"delete is-clickable is-size-3 close-chat-interface",onClick:c,onKeyUp:function(e){return"Enter"===e.key&&c()},dangerouslySetInnerHTML:{__html:"&#215;"}}),Object(g.jsx)(w,{members:n}),Object(g.jsxs)("div",{className:"chat-messages box mt-2 p-3",children:[Object(g.jsx)("div",{className:"is-full-width is-flex is-justify-content-center mb-4",children:Object(g.jsx)("div",{className:"tag is-dark",children:"This is the beginning of your conversation history"})}),s.map((function(e,t){return e.sender===l?Object(g.jsx)("div",{className:"is-full-width is-flex is-justify-content-flex-end mb-2",children:Object(g.jsx)("div",{className:"tag is-medium is-link from-me-message is-pulled-right",children:e.message})},"chat-me-".concat(t)):Object(g.jsx)("div",{className:"mb-2",children:Object(g.jsx)("div",{className:"tag is-medium is-light to-me-message",children:e.message})},"chat-others-".concat(t))})),Object(g.jsx)("div",{id:"last-chat-element"})]}),Object(g.jsx)("div",{className:"chat-send-box box mt-2 p-3",children:Object(g.jsxs)("div",{className:"is-flex",children:[Object(g.jsx)("input",{className:"input is-normal",type:"text",placeholder:"Enter your message",value:a,onChange:function(e){return r(e.target.value)},onKeyUp:function(e){return"Enter"===e.key&&o()}}),Object(g.jsx)("div",{className:"button is-primary ml-2",tabIndex:0,onClick:o,disabled:!a||!a.length,children:"Send"})]})})]})},E=function(e){var t=e.showChat,n=e.channel,c=e.chatHistory,a=e.setChatHistory,r=e.unreadMessage,l=e.setUnreadStatus,u=e.members,b=Object(s.useState)(!1),d=Object(x.a)(b,2),h=d[0],m=d[1],j=Object(s.useState)(""),f=Object(x.a)(j,2),O=f[0],v=f[1],p=Object(i.f)().email;if(Object(s.useEffect)((function(){var e=document.getElementById("last-chat-element");e&&e.scrollIntoView()}),[c,h]),Object(s.useEffect)((function(){var e=function(e){27===e.keyCode&&y(!1)};h?document.addEventListener("keydown",e,!1):document.removeEventListener("keydown",e,!1)}),[h]),!n||!t)return null;var y=function(){h?document.body.classList.remove("not-vertically-scrollable"):(l(!1),document.body.classList.add("not-vertically-scrollable")),m(!h)};return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsxs)("button",{className:"button",tabIndex:0,onClick:y,disabled:Object.values(u).length<2,onKeyUp:function(e){return"Enter"===e.key&&y()},children:["Workout Chat",r&&Object(g.jsx)("div",{className:"dot ml-1 has-background-primary"})]}),Object.values(u).length<2&&Object(g.jsx)("div",{className:"mt-2",children:"Waiting for others to join the workout :)"}),Object(g.jsx)(C,{open:h,members:u,chatHistory:c,closeChat:function(){y(!1)},message:O,setMessage:v,sendMessage:function(){if(O&&O.length){var e={id:c.length+1,sender:p,message:O,timestamp:Date.now()};n.trigger("client-chat-message",e),a([].concat(Object(o.a)(c),[e])),v("")}}})]})},I=function(e){Object(h.a)(n,e);var t=Object(m.a)(n);function n(e){var s;Object(b.a)(this,n),(s=t.call(this,e)).setChatHistory=function(e){s.setState({chatHistory:e})},s.setUnreadStatus=function(e){s.setState({unreadMessage:e})},s.state={chatHistory:[],unreadMessage:!1,members:[],showChat:!1};return f.a.logToConsole=!1,s.pusher=new f.a("cebc878343c66e63a78e",{cluster:"us3",authEndpoint:"".concat("https://glacial-plateau-65219.herokuapp.com","/pusher/auth"),auth:{headers:{Authorization:localStorage.getItem("currentUserToken")||""}}}),s.channel=s.pusher.subscribe("presence-workoutChannel-".concat(s.identifier)),s}return Object(d.a)(n,[{key:"identifier",get:function(){return this.props.selectedWorkout.identifier}},{key:"componentDidMount",value:function(){var e=this;this.channel.bind("pusher:subscription_succeeded",(function(e){this.setState({members:e.members,showChat:!0})}),this),this.channel.bind("pusher:member_added",(function(e){var t=Object(u.a)(Object(u.a)({},this.state.members),{},Object(l.a)({},e.id,e.info));this.setState({members:t})}),this),this.channel.bind("pusher:member_removed",(function(e){var t=this,n=Object.keys(this.state.members).filter((function(t){return"".concat(t)!=="".concat(e.id)})).reduce((function(e,n){return e[n]=t.state.members[n],e}),{});this.setState({members:n})}),this),this.channel.bind("client-chat-message",(function(t){e.setState({chatHistory:[].concat(Object(o.a)(e.state.chatHistory),[Object(u.a)({},t)]),unreadMessage:!0})}),this)}},{key:"componentWillUnmount",value:function(){this.pusher.unsubscribe("presence-workoutChannel-".concat(this.identifier)),this.channel&&this.channel.unbind(),document.body.classList.remove("not-vertically-scrollable")}},{key:"render",value:function(){return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsxs)("div",{className:"buttons",children:[Object(g.jsx)(y,{}),Object(g.jsx)(k,{})]}),Object(g.jsx)(S,{}),Object(g.jsx)(E,Object(u.a)({channel:this.channel,setChatHistory:this.setChatHistory,setUnreadStatus:this.setUnreadStatus},this.state))]})}}]),n}(s.Component);t.default=function(e){var t=e.match.params.identifier,n=Object(i.f)(),o=n.selectedWorkout,l=n.error,u=n.loading,b=Object(i.e)();return Object(s.useEffect)((function(){Object(r.b)(t,b)}),[t,b]),u?Object(g.jsx)(a.a,{}):o&&Object.keys(o).length?Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)("nav",{className:"breadcrumb","aria-label":"breadcrumbs",children:Object(g.jsxs)("ul",{children:[Object(g.jsx)("li",{children:Object(g.jsx)(c.b,{to:"/workouts",className:"",children:"Workouts"})}),Object(g.jsx)("li",{className:"is-active",children:Object(g.jsx)("div",{className:"ml-3",children:o.name})})]})}),Object(g.jsx)(I,{selectedWorkout:o})]}):Object(g.jsxs)("div",{className:"has-text-centered",children:[Object(g.jsx)("h1",{className:"is-size-3",children:l}),Object(g.jsx)(c.b,{to:"/workouts",className:"button mt-3",children:"Return to My Workouts"})]})}}}]);
//# sourceMappingURL=5.967a281d.chunk.js.map