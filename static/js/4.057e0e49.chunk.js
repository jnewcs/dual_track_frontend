(this.webpackJsonpdual_track_frontend=this.webpackJsonpdual_track_frontend||[]).push([[4],{88:function(e,t,n){"use strict";t.a=function(e){var t=e.condition,n=void 0===t||t,s=e.children;return n?s:null}},94:function(e,t,n){"use strict";n.r(t);var s=n(14),c=n(1),i=n(9),a=n(34),r=n(88),o=n(95);function l(e){var t=e/36e5,n=60*(t-Math.floor(t)),s=Math.floor(n),c=60*(n-s),i=Math.floor(c),a=100*(c-i),r=Math.floor(a),o=s.toString().padStart(2,"0"),l=i.toString().padStart(2,"0"),u=r.toString().padStart(2,"0");return"".concat(o,":").concat(l,":").concat(u)}function u(){return Object(o.a)()}var d=n(4),b=n(23),j=n(0),h=function(){var e=localStorage.getItem("previousSessions")||[];return e&&e.length?Object(j.jsx)("div",{children:"We have previous session data!"}):Object(j.jsx)("div",{className:"is-size-3 has-text-centered",children:"You have not run this workout before"})},m=n(89),O=n(35),f=n(2),v=n(16),x=n(17),p=n(18),g=n(19),k=n(90),y=n.n(k),S=n(5),N=n.n(S),w=n(10),C=function(){var e=Object(c.useState)(null),t=Object(s.a)(e,2),n=t[0],i=t[1],a=Object(c.useState)(!1),r=Object(s.a)(a,2),o=r[0],l=r[1];if(!("wakeLock"in navigator))return null;var u=function(){var e=Object(w.a)(N.a.mark((function e(){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.wakeLock.request("screen");case 3:t=e.sent,i(t),l(!0),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("".concat(e.t0.name,", ").concat(e.t0.message));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),d=function(){n&&n.release(),i(null),l(!1)};return Object(j.jsx)(j.Fragment,{children:o?Object(j.jsx)("div",{className:"button",tabIndex:"0",onClick:d,onKeyUp:function(e){return"Enter"===e.key&&d()},children:"Unlock Page"}):Object(j.jsx)("div",{className:"button",tabIndex:"0",onClick:u,onKeyUp:function(e){return"Enter"===e.key&&u()},children:"Lock Page"})})},I=function(){var e=Object(c.useState)(!!document.fullscreenElement),t=Object(s.a)(e,2),n=t[0],i=t[1],a=function(){document.documentElement.requestFullscreen(),i(!0)},r=function(){document.exitFullscreen(),i(!1)};return Object(j.jsx)(j.Fragment,{children:n?Object(j.jsx)("div",{className:"button",tabIndex:"0",onClick:r,onKeyUp:function(e){return"Enter"===e.key&&r()},children:"Leave Full Screen"}):Object(j.jsx)("div",{className:"button",tabIndex:"0",onClick:a,onKeyUp:function(e){return"Enter"===e.key&&a()},children:"Enter Full Screen"})})},W=function(e){var t=e.members,n=Object(d.f)().email;return!t||t.count<2?null:Object(j.jsx)("div",{children:Object.values(t).map((function(e){var t=e.email===n?"is-link":"is-light";return Object(j.jsx)("div",{className:"tag mr-1 mb-1 ".concat(t),children:e.email},e.email)}))})},E=function(e){var t=e.open,n=e.members,s=e.chatHistory,c=e.closeChat,i=e.message,a=e.setMessage,r=e.sendMessage,o=Object(d.f)().email;return!t||!n||Object.values(n).length<2?null:Object(j.jsxs)("div",{className:"chat-interface box has-background-link-light p-5",children:[Object(j.jsx)("div",{tabIndex:0,className:"delete is-clickable is-size-3 close-chat-interface",onClick:c,onKeyUp:function(e){return"Enter"===e.key&&c()},dangerouslySetInnerHTML:{__html:"&#215;"}}),Object(j.jsx)(W,{members:n}),Object(j.jsxs)("div",{className:"chat-messages box mt-2 p-3",children:[Object(j.jsx)("div",{className:"is-full-width is-flex is-justify-content-center mb-4",children:Object(j.jsx)("div",{className:"tag is-dark",children:"This is the beginning of your conversation history"})}),s.map((function(e,t){return e.sender===o?Object(j.jsx)("div",{className:"is-full-width is-flex is-justify-content-flex-end mb-2",children:Object(j.jsx)("div",{className:"tag is-medium is-link from-me-message is-pulled-right",children:e.message})},"chat-me-".concat(t)):Object(j.jsx)("div",{className:"mb-2",children:Object(j.jsx)("div",{className:"tag is-medium is-light to-me-message",children:e.message})},"chat-others-".concat(t))})),Object(j.jsx)("div",{id:"last-chat-element"})]}),Object(j.jsx)("div",{className:"chat-send-box box mt-2 p-3 mb-2",children:Object(j.jsxs)("div",{className:"is-flex",children:[Object(j.jsx)("input",{className:"input is-normal",type:"text",placeholder:"Enter your message",value:i,onChange:function(e){return a(e.target.value)},onKeyUp:function(e){return"Enter"===e.key&&r()}}),Object(j.jsx)("div",{className:"button is-primary ml-2",tabIndex:0,onClick:r,disabled:!i||!i.length,children:"Send"})]})})]})},F=function(e){var t=e.showChat,n=e.channel,i=e.chatHistory,a=e.setChatHistory,r=e.unreadMessage,o=e.setUnreadStatus,l=e.members,u=Object(c.useState)(!1),b=Object(s.a)(u,2),h=b[0],O=b[1],f=Object(c.useState)(""),v=Object(s.a)(f,2),x=v[0],p=v[1],g=Object(d.f)().email;if(Object(c.useEffect)((function(){var e=document.getElementById("last-chat-element");e&&e.scrollIntoView()}),[i,h]),Object(c.useEffect)((function(){var e=function(e){27===e.keyCode&&k(!1)};h?document.addEventListener("keydown",e,!1):document.removeEventListener("keydown",e,!1)}),[h]),!n||!t)return null;var k=function(){h?document.body.classList.remove("not-vertically-scrollable"):(o(!1),document.body.classList.add("not-vertically-scrollable")),O(!h)};return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsxs)("button",{className:"button",tabIndex:0,onClick:k,disabled:Object.values(l).length<2,onKeyUp:function(e){return"Enter"===e.key&&k()},children:["Workout Chat",r&&Object(j.jsx)("div",{className:"dot ml-1 has-background-primary"})]}),Object(j.jsx)(E,{open:h,members:l,chatHistory:i,closeChat:function(){k(!1)},message:x,setMessage:p,sendMessage:function(){if(x&&x.length){var e={id:i.length+1,sender:g,message:x,timestamp:Date.now()};n.trigger("client-chat-message",e),a([].concat(Object(m.a)(i),[e])),p("")}}})]})},U=function(e){var t=e.showFinish,n=void 0===t||t,i=e.onPlayCallback,a=void 0===i?function(){}:i,r=e.onStopCallback,o=void 0===r?function(){}:r,u=e.onFinishCallback,d=void 0===u?function(){}:u,b=Object(c.useState)(!1),h=Object(s.a)(b,2),m=h[0],O=h[1],f=Object(c.useState)(null),v=Object(s.a)(f,2),x=v[0],p=v[1],g=Object(c.useState)(0),k=Object(s.a)(g,2),y=k[0],S=k[1],N=Object(c.useState)(null),w=Object(s.a)(N,2),C=w[0],I=w[1],W=function(){m?(clearInterval(C),o()):(p(Date.now()-y),a()),O(!m)};Object(c.useEffect)((function(){W()}),[]),Object(c.useEffect)((function(){if(null===x)clearInterval(C),I(null),S(0);else{var e=setInterval((function(){S(null===x?0:Date.now()-x)}),10);I(e)}}),[x]);var E=function(){m&&(W(),d(y))};return Object(j.jsxs)("div",{className:"has-text-centered is-flex is-flex-direction-column is-align-items-center",children:[Object(j.jsx)("div",{className:"stopwatch-circle circle is-flex is-justify-content-center is-align-items-center",children:Object(j.jsx)("span",{className:"time is-size-4",id:"display",children:y?l(y):"00:00:00"})}),Object(j.jsxs)("div",{className:"mt-3 is-flex is-justify-content-space-between is-align-items-center",children:[Object(j.jsx)("img",{className:"is-clickable",tabIndex:0,id:"main-action-button",alt:m?"pause stopwatch":"start stopwatch",src:m?"https://res.cloudinary.com/https-tinloof-com/image/upload/v1593360448/blog/time-in-js/pause-button_pinhpy.svg":"https://res.cloudinary.com/https-tinloof-com/image/upload/v1593360448/blog/time-in-js/play-button_opkxmt.svg",onClick:W,onKeyUp:function(e){return"Enter"===e.key&&W()}}),n&&m&&Object(j.jsx)("div",{className:"button ml-5 is-medium",tabIndex:0,id:"reset-button",onClick:E,onKeyUp:function(e){return"Enter"===e.key&&E()},children:"Finish"})]})]})},M=function(e,t){var n=t-e/1e3;return n<-8?"notification is-danger":n<-4?"notification is-warning":"notification is-success"},_=function(e){var t=e.workoutStarted,n=e.finishTime,s=e.timeGoal,c=e.startClick,i=e.onFinishCallback,a=e.showStopwatch;return t?n?Object(j.jsxs)("div",{className:M(n,s),children:[Object(j.jsx)("b",{className:"is-size-5",children:"Actual Time"}),Object(j.jsx)("br",{}),l(n)]}):Object(j.jsxs)(j.Fragment,{children:[!a&&Object(j.jsx)("div",{tabIndex:0,className:"button is-primary is-medium",onClick:c,children:"Start"}),a&&Object(j.jsx)(U,{onFinishCallback:i})]}):null},L=function(e){var t=e.segment,n=e.segmentLength,i=e.index,a=e.workoutStarted,r=Object(c.useState)(!1),o=Object(s.a)(r,2),l=o[0],u=o[1],d=Object(c.useState)(null),b=Object(s.a)(d,2),h=b[0],m=b[1];return Object(j.jsx)("div",{className:"column is-one-third",children:Object(j.jsxs)("div",{className:"card",children:[Object(j.jsxs)("div",{className:"segment-position",children:[i+1," / ",n]}),Object(j.jsx)("div",{className:"card-content pt-1",children:Object(j.jsxs)("div",{className:"content",children:[Object(j.jsxs)("div",{className:"columns mt-1 is-flex",children:[Object(j.jsxs)("div",{className:"column is-half",children:[Object(j.jsxs)("b",{className:"is-size-5",children:[t.display_length," Goal"]}),Object(j.jsx)("br",{}),t.time_goal," seconds"]}),Object(j.jsxs)("div",{className:"column is-half",children:[Object(j.jsx)("b",{className:"is-size-5",children:"Rest"}),Object(j.jsx)("br",{}),t.rest," seconds"]})]}),Object(j.jsx)(_,{finishTime:h,timeGoal:t.time_goal,showStopwatch:l,startClick:function(){u(!l)},onFinishCallback:function(e){u(!1),m(e)},workoutStarted:a}),Object(j.jsx)("hr",{}),Object(j.jsx)("p",{children:t.description})]})})]})})},H=function(e){var t=e.selectedWorkout,n=e.workoutStarted;if(!t.segments.length)return Object(j.jsx)("p",{className:"mb-3",children:"Workout cannot start. No segments added yet :("});var s=t.segments,c=s.length;return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsxs)("div",{className:"is-size-3 mb-5",children:[c," Total ",1===c?"Segment":"Segments"]}),Object(j.jsx)("div",{className:"segments columns",children:s.map((function(e,t){return Object(j.jsx)(L,{segment:e,segmentLength:c,index:t,workoutStarted:n},e.identifier)}))})]})},z=function(e){Object(p.a)(n,e);var t=Object(g.a)(n);function n(e){var s;return Object(v.a)(this,n),(s=t.call(this,e)).setChatHistory=function(e){s.setState({chatHistory:e})},s.setUnreadStatus=function(e){s.setState({unreadMessage:e})},s.startWorkoutWrapper=function(){s.props.startWorkout(s.channel)},s.state={chatHistory:[],unreadMessage:!1,members:[],showChat:!1},y.a.logToConsole=!1,s.pusher=new y.a("cebc878343c66e63a78e",{cluster:"us3",authEndpoint:"".concat("https://glacial-plateau-65219.herokuapp.com","/pusher/auth"),auth:{headers:{Authorization:localStorage.getItem("currentUserToken")||""}}}),s.channel=s.pusher.subscribe("presence-workoutChannel-".concat(s.identifier)),s}return Object(x.a)(n,[{key:"identifier",get:function(){return this.props.selectedWorkout.identifier}},{key:"componentDidMount",value:function(){var e=this;this.channel.bind("pusher:subscription_succeeded",(function(e){this.setState({members:e.members,showChat:!0})}),this),this.channel.bind("pusher:member_added",(function(e){var t=Object(f.a)(Object(f.a)({},this.state.members),{},Object(O.a)({},e.id,e.info));this.setState({members:t})}),this),this.channel.bind("pusher:member_removed",(function(e){var t=this,n=Object.keys(this.state.members).filter((function(t){return"".concat(t)!=="".concat(e.id)})).reduce((function(e,n){return e[n]=t.state.members[n],e}),{});this.setState({members:n})}),this),this.channel.bind("client-chat-message",(function(t){e.setState({chatHistory:[].concat(Object(m.a)(e.state.chatHistory),[Object(f.a)({},t)]),unreadMessage:!0})}),this),this.channel.bind("client-workout-started",(function(t){e.props.mirrorWorkout(t)}),this)}},{key:"componentWillUnmount",value:function(){this.pusher.unsubscribe("presence-workoutChannel-".concat(this.identifier)),this.channel&&this.channel.unbind(),this.pusher.disconnect(),document.body.classList.remove("not-vertically-scrollable")}},{key:"showStartWorkoutButton",get:function(){return!this.props.workoutStarted&&!!this.props.selectedWorkout.segments.length}},{key:"render",value:function(){return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsxs)("div",{className:"buttons",children:[Object(j.jsx)(r.a,{condition:this.showStartWorkoutButton,children:Object(j.jsx)("div",{tabIndex:0,className:"button is-primary",onClick:this.startWorkoutWrapper,children:"Start Workout"})}),Object(j.jsx)(C,{}),Object(j.jsx)(I,{}),Object(j.jsx)(F,Object(f.a)({channel:this.channel,setChatHistory:this.setChatHistory,setUnreadStatus:this.setUnreadStatus},this.state))]}),Object(j.jsx)(W,{members:this.state.members}),Object(j.jsx)(H,{selectedWorkout:this.props.selectedWorkout,workoutStarted:this.props.workoutStarted})]})}}]),n}(c.Component);t.default=function(e){var t=e.match.params.identifier,n=Object(d.f)(),o=n.selectedWorkout,l=n.error,m=n.loading,O=Object(d.e)(),f=Object(c.useState)("current"),v=Object(s.a)(f,2),x=v[0],p=v[1],g=localStorage.getItem("liveSessionIdentifier")||null,k=localStorage.getItem("liveWorkoutIdentifier")||null,y=!!g&&t===k,S=Object(c.useState)(y),N=Object(s.a)(S,2),w=N[0],C=N[1],I=y?g:null,W=Object(c.useState)(I),E=Object(s.a)(W,2),F=E[0],U=E[1],M=function(e,t){localStorage.setItem("liveSessionIdentifier",e),localStorage.setItem("liveWorkoutIdentifier",t),C(!0),U(e)};return Object(c.useEffect)((function(){Object(b.b)(t,O)}),[t,O]),m?Object(j.jsx)(a.a,{}):o&&Object.keys(o).length?Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("nav",{className:"breadcrumb mb-1","aria-label":"breadcrumbs",children:Object(j.jsxs)("ul",{children:[Object(j.jsx)("li",{children:Object(j.jsx)(i.b,{to:"/workouts",className:"",children:"Workouts"})}),Object(j.jsx)("li",{className:"is-active",children:Object(j.jsx)("div",{className:"ml-3",children:o.name})})]})}),Object(j.jsx)(r.a,{condition:!w,children:Object(j.jsx)("div",{className:"tabs is-medium",children:Object(j.jsxs)("ul",{children:[Object(j.jsx)("li",{className:"current"===x?"is-active":void 0,children:Object(j.jsx)("a",{className:"tab",onClick:function(){return p("current")},children:"Current"})}),Object(j.jsx)("li",{className:"previous"===x?"is-active":void 0,children:Object(j.jsx)("a",{className:"tab",onClick:function(){return p("previous")},children:"Previous Sessions"})})]})})}),Object(j.jsx)(r.a,{condition:w,children:Object(j.jsx)("div",{className:"is-size-4 mb-2",children:"Workout is Live!"},F)}),"current"===x&&Object(j.jsx)(z,{selectedWorkout:o,workoutStarted:w,startWorkout:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=u();M(n,t),e&&e.trigger("client-workout-started",{uuid:n,identifier:t})},mirrorWorkout:function(e){M(e.uuid,e.identifier)}}),"previous"===x&&Object(j.jsx)(h,{})]}):Object(j.jsxs)("div",{className:"has-text-centered",children:[Object(j.jsx)("h1",{className:"is-size-3",children:l}),Object(j.jsx)(i.b,{to:"/workouts",className:"button mt-3",children:"Return to My Workouts"})]})}}}]);
//# sourceMappingURL=4.057e0e49.chunk.js.map